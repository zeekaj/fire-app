## Quick context for automated coding agents

This repo is a single-user React + TypeScript frontend backed by Supabase (Postgres + Auth + RLS). The app is built with Vite and expects Supabase environment variables to run locally. The client uses only the anon key and relies on database Row Level Security (RLS) to enforce ownership.

Keep changes small and scoped. The codebase favors idempotent, safe first-run setup (see `src/lib/first-login-setup.ts`) and prefers fixing small user-facing bugs or adding feature-sized changes rather than sweeping refactors.

## Architecture highlights (what to know quickly)
- Frontend only: `src/` contains the whole app. No server code. Main entry: `src/main.tsx` -> `src/App.tsx`.
- State: React Query for server cache (`@tanstack/react-query`) and Zustand for ephemeral UI state (see feature folders).
- Authentication & DB: `src/lib/supabase.ts` exports a typed `supabase` client. Auth flows are handled in `src/app/providers/AuthProvider.tsx` and guarded by `AuthGate.tsx`.
- First-login setup: `runFirstLoginSetup()` is invoked in `src/App.tsx` when a user signs in. It's idempotent and seeds defaults (accounts, categories, settings).
- Feature modules live in `src/features/*` (accounts, transactions, bills, budgets, scenarios, dashboard). Each feature typically exposes an `index.ts` and `components/` + `hooks/` folders.

## Important files to reference when editing
- Supabase client & types: `src/lib/supabase.ts`, `src/lib/database.types.ts` (generated by `npm run supabase:types:remote`).
- First-login orchestration: `src/lib/first-login-setup.ts`.
- App shell and routing: `src/App.tsx`, `src/main.tsx`.
- Auth helpers and gating: `src/app/providers/AuthProvider.tsx`, `src/app/providers/AuthGate.tsx`.
- Feature entrypoints: `src/features/*/index.ts` and `src/features/*/components/*`.
- Migrations and schema: `supabase/migrations/*.sql` (applies via `npm run supabase:push`).

## Local dev and build commands (authoritative)
- Install: `npm install`
- Dev server: `npm run dev` (Vite, localhost:3000)
- Build: `npm run build` (runs `tsc` then Vite build)
- Typecheck: `npm run type-check`
- Tests: unit `npm run test` (Jest), e2e `npm run test:e2e` (Playwright)
- Supabase helpers: `npm run supabase:push`, `npm run supabase:types:remote`, `npm run supabase:start` (local DB)

When changing code that touches DB shapes, run `npm run supabase:types:remote` to refresh `src/lib/database.types.ts` and `npm run type-check`.

## Project-specific conventions and gotchas
- Environment: The client expects `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY` in `.env.local`. Throwing an error on missing env vars is intentional in `src/lib/supabase.ts`.
- Auth: Only Google OAuth is supported and auth state is managed via Supabase client. `AuthProvider` upserts a `users` row on sign-in â€” keep this idempotent behavior when modifying auth flows.
- RLS: All DB operations assume RLS policies (rows owned by `created_by = auth.uid()`). Server-side migration changes must keep RLS-compatible column semantics.
- First-run scripts: `runFirstLoginSetup()` is safe to call multiple times and will seed defaults; prefer updating it for small onboarding fixes.
- UI patterns: Small, focused components. Follow existing folder structure: feature/index exports and `components/` + `hooks/` inside feature folders.

## Editing guidance for AI agents
- Make minimal changes and run type checks (`npm run type-check`) before opening PRs. Avoid touching global styles or layout unless required.
- When adding DB fields: update SQL migrations in `supabase/migrations/`, then refresh types with `npm run supabase:types:remote` and run type-checks.
- When working on auth or user creation flows, mirror `AuthProvider` behavior (upsert user on sign-in) to avoid duplicate user records.
- Tests: Add unit tests alongside new logic in the same feature folder. E2E tests live under Playwright config (see `package.json` script `test:e2e`).

## Example tasks and where to start
- Fix transaction quick-add UX: `src/features/transactions/components/QuickAddTransaction.tsx` + React Query hooks in `src/features/transactions/hooks`.
- Add a new scenario parameter: update `src/features/scenarios/scenarios.types.ts`, UI in `src/features/scenarios/components`, and handle persistence through Supabase client usage.
- Update migrations: add a new `supabase/migrations/0X_my_change.sql` and include a short description in the file header.

If anything in this file is unclear or you need more examples (test locations, Playwright setup, or CI specifics), tell me which area to expand and I'll iterate.
